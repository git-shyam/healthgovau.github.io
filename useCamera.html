<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
</head>
<body>
<video id="video" width="640" height="480" autoplay></video>
<button id="camera">Open Camera</button>
<button id="snap">Snap Photo</button>
<button id="send">SSend Photo</button>
<select id="cameras"><option></option></select>
<canvas id="canvas" width="640" height="480"></canvas>
<script>
	

	// Grab elements, create settings, etc.
	var video = document.getElementById('video');
	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d');
	var currentStream;


	document.getElementById("camera").addEventListener("click", function() {
		// Get access to the camera!
		if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
		    // Not adding `{ audio: true }` since we only want video now
			
			navigator.mediaDevices.enumerateDevices().then(function(devices){
			    devices.forEach(function(device) {
			      console.log(device);
			      if(device.kind == "videoinput"){
		      		$("#cameras").append('<option value="' + device.deviceId + '">' + device.label + '</option>');
		      		}
			    });
			  })
			  .catch(function(err) {
			    console.log(err.name + ": " + error.message);
			  });

		    };
		});	

	$('#cameras').change(function(){
		if(currentStream){
			currentStream.getTracks()[0].stop();
		}
		console.log($(this).find(":selected").val());
		var constraints = { deviceId: { exact: $(this).find(":selected").val() } };
    	navigator.mediaDevices.getUserMedia({ video: constraints }).then(function(stream) {
    		currentStream = stream;
    		var track = stream.getTracks()[0];  // if only one media track
			track.stop();
        	video.src = window.URL.createObjectURL(stream);		
		});
    });

	// Trigger photo take
	document.getElementById("snap").addEventListener("click", function() {
		context.drawImage(video, 0, 0, 640, 480);
	});
	document.getElementById("send").addEventListener("click", function() {
		var image = new Image();
		image.src = canvas.toDataURL("image/png");
		alert(image);
		return image;		
	});	
</script>



</body>
</html>